<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GitHub App Repo List</title>
    <link rel="stylesheet" href="/api/static?file=styles.css"/></head>
<body>
    <div class="container">
        <h1>GitHub App Repositories</h1>
        <button id="fetchRepos">Fetch Repositories</button>
        <ul id="repoList"></ul>
    </div>

    <h2>Create Issue</h2>
    <input type="text" id="repoName" placeholder="Repo (owner/repo)" />
    <input type="text" id="issueTitle" placeholder="Issue Title" />
    <textarea id="issueBody" placeholder="Issue Description"></textarea>
    <button id="createIssue">Create Issue</button>
    <p id="issueResult"></p>


    <script>
        document.getElementById('fetchRepos').addEventListener('click', async () => {
            try {
                const response = await fetch('https://github-app-backend.vercel.app/api/list-repos.js');
                const data = await response.json();
                const repos = data.repositories;

                const repoList = document.getElementById('repoList');
                repoList.innerHTML = '';

                repos.forEach(repo => {
                    const listItem = document.createElement('li');
                    listItem.textContent = repo.full_name;
                    repoList.appendChild(listItem);
                });
            } catch (error) {
                console.error('Error fetching repositories:', error);
            }
        });

        document.getElementById('createIssue').addEventListener('click', async () => {
            const repo = document.getElementById('repoName').value;
            const title = document.getElementById('issueTitle').value;
            const body = document.getElementById('issueBody').value;

            try {
                const response = await fetch('https://github-app-backend.vercel.app/api/create-issue.js', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ repo, title, body })
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('issueResult').innerText = `Issue Created: ${data.html_url}`;
                } else {
                    document.getElementById('issueResult').innerText = 'Error creating issue.';
                }
            } catch (error) {
                console.error(error);
                document.getElementById('issueResult').innerText = 'Error creating issue.';
            }
        });

    </script>
</body>
</html>